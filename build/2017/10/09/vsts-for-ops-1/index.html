<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    

    <title>XYZ Blog</title>
    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
    

    <script src="/js/script.js"></script>
    </head>
  <body class="position-relative" data-spy="scroll" data-target=".site-nav" data-offset="55">
    <nav class="site-nav family-sans navbar navbar-expand-md navbar-dark  sidebar sticky-top  py-0">
  <div class="container-fluid">
    <button type="button" class="navbar-toggler my-2 my-md-0" data-toggle="collapse" data-target="#myTogglerNav" aria-controls="myTogglerNav" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-brand text-uppercase">
      <a class="text-light" href="/"><i class="fas fa-cube mr-2"></i>XYZ Blog</a> 
    </div>

    <div class="collapse navbar-collapse text-center mt-0" id="myTogglerNav">
      <div class="navbar-nav ml-auto font-weight-regular text-uppercase">
        
        <a class="d-none nav-item nav-link" href="#page-hero">hero target</a>
        <a class="d-none nav-item nav-link" href="#main-content">nav target</a>
        
        <a class="nav-item nav-link font-weight-bold  text-light" href="/"><i class="fas fa-home"></i></a>
        
          <a class="nav-item nav-link" href="/courses/0/">courses</a>
          
          <a class="nav-item nav-link" href="/posts/0/">posts</a>
          <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Projects
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">




          <a class="dropdown-item text-capitalize text-normal" href="/projects/seven/"><i class="fas fa-atom"></i> seven</a><a class="dropdown-item text-capitalize text-normal" href="/projects/rayveal/"><i class="fas fa-atom"></i> rayveal</a></div>
        </div>
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item text-capitalize" href="/about">About Me</a>
            <div class="dropdown-divider"></div><a class="dropdown-item text-capitalize" target="_blank" href="https://github.com/etiennedeneuve">
            <i class="fab fa-github text-secondary mr-2"></i>github
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://linkedin.com/in/etiennedeneuve">
            <i class="fab fa-linkedin text-secondary mr-2"></i>linkedin
          </a><a class="dropdown-item text-capitalize" target="_blank" href="https://twitter.com/etiennedinfo">
            <i class="fab fa-twitter text-secondary mr-2"></i>twitter
          </a></div>
        </div>
      </div>
      <div class="searchbox pl-2 py-2">
    <input
      type="text"
      v-model="query"
      class="form-control text-white border m-auto"
      :class="[isActive ? 'wide' : 'short']"
      @focus="isActive=true"
      @blur.prevent="handleBlur"
      ref="searchinput"
      style="background: transparent;"
      aria-describedby="searchinput"
      autocomplete="off"
    >
    <div v-if="query && isActive" class="position-absolute justify-content-center" style="top: 47px;">
      <div class="card bg-secondary">
        <ul class="list-group list-group-flush px-0" v-for="(item, index) in queried" :key="index">
          <li class="list-group-item">
            <a :href="item.url" class="d-flex text-secondary">
              <span class="pr-2" v-html="item.icon"></span>
              <span class="text-body text-left" v-html="item.title"></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
</div>
    </div>
  </div>
</nav>

      

 
  <div class="post post-sidebar container-fluid">
    <div class="row justify-content-xl-center">
      <aside class="aside aside-main d-none d-md-block col-md-3 col-lg-2">
        <nav class="sticky-top list-group list-group-flush text-right" id="collapseExample">

          </nav>
      </aside>


      <main class="main col">
      <p>Dans cet article, je vous détaille la partie (cachée) de ma démo lors de ma session au Microsoft Expérience 17 avec Stanislas Quastana. Le but de cet article est de préparer le terrain pour les articles suivants. Les prochains arriverons rapidement, avec dans l'idée, de vous aider à mieux appréhendez le CI/CD en tant qu'OPS, pour des sujets qui nous concernent, l'infra as code.<br>
Voici le chemin que nous allons suivre :</p>
<ol>
<li>Préparation de l'environnement [nous sommes ici]</li>
<li>Préparation d'une image de base Linux</li>
<li>Préparation d'une image de base Windows</li>
<li>Utilisation des images de base pour les spécialiser, afin de les rendre &quot;Immutables&quot;</li>
<li>Déploiement d'image en CI/CD avec Packer et Terraform depuis VSTS<br>
Nous utiliserons des technologies Microsoft (VSTS, Azure, Windows Server...) mais aussi HashiCorp (Packer, Terraform) ainsi que des technologies Open Source (Linux..). Il n'est normalement pas nécessaire d’être, ni un maître du cloud, ni un demi dieu de l'infra as code pour suivre cette mini séries de 4 articles.</li>
</ol>
<h1 id="cr%C3%A9ation-des-comptes-n%C3%A9cessaire">Création des comptes nécessaire <a class="direct-link" href="#cr%C3%A9ation-des-comptes-n%C3%A9cessaire"> </a></h1>
<p>Il faut créer un compte sur Visual Studio Team Services <a href="https://go.microsoft.com/fwlink/?LinkId=307137">ici</a> et un compte Azure <a href="https://azure.microsoft.com/fr-fr/offers/ms-azr-0044p/">ici</a>.</p>
<h1 id="cr%C3%A9ation-du-workspace-vsts">Création du Workspace VSTS <a class="direct-link" href="#cr%C3%A9ation-du-workspace-vsts"> </a></h1>
<h2 id="cr%C3%A9ation-du-projet">Création du Projet <a class="direct-link" href="#cr%C3%A9ation-du-projet"> </a></h2>
<p><a href="https://%7Bvotrenomavous%7D.visualstudio.com/_projects?_a=new">https://{votrenomavous}.visualstudio.com/_projects?_a=new</a><br>
Indiquez le nom que vous souhaitez et sélectionnez Git comme &quot;Version Control&quot; :</p>
<img class="alignnone wp-image-322 size-full" src="https://etienne.deneuve.xyz/wp-content/uploads/2017/10/vsts-1-1.png" alt="" width="1680" height="793" />
<h2 id="initialisation-du-repository">Initialisation du repository <a class="direct-link" href="#initialisation-du-repository"> </a></h2>
<img class="alignnone size-full wp-image-323" src="https://etienne.deneuve.xyz/wp-content/uploads/2017/10/vsts-2-1.png" alt="" width="1675" height="697" />
## C'est prêt !
<img class="alignnone size-full wp-image-324" src="https://etienne.deneuve.xyz/wp-content/uploads/2017/10/vsts-3-1.png" alt="" width="1239" height="326" />
<p>Voila, 3 étapes, notre premier projet est &quot;prêt&quot;.</p>
<h1 id="pr%C3%A9paration-de-l'agent-pour-vsts">Préparation de l'Agent pour VSTS <a class="direct-link" href="#pr%C3%A9paration-de-l'agent-pour-vsts"> </a></h1>
<h2 id="pr%C3%A9paration-de-la-vm">Préparation de la VM <a class="direct-link" href="#pr%C3%A9paration-de-la-vm"> </a></h2>
<p>Dans Azure, avec le <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-simple-linux">template suivant</a>, déployez une vm Ubuntu basique.<br>
Installez les prérequis de l'agent VSTS via les commandes suivantes :</p>
<pre><code>sudo apt-get install -y libunwind8 libcurl3
sudo apt-add-repository ppa:git-core/ppa
sudo apt-get update
sudo apt-get install git
apt-get install libcurl4-openssl-dev
</code></pre>
<h2>Installation de l'agent</h2>
<h3>Préparation dans VSTS</h3>
Accédez à la partie sécurité https://{votrenomavous}.visualstudio.com/_details/security/tokens et créer un PAT (Personnal Access Tokens).
<blockquote>Attention, c'est comme un mot de passe, il ne faut pas le diffuser. (Keepass, LastPass et autres peuvent les stocker correctement!).</blockquote>
Dans notre cas, l'agent devra avoir les droits Agent Pools et Deployment Group, car nous n'utiliserons qu'un seul agent. En prod, séparez-les !
<h3>Installation de l'agent</h3>
```
wget https://github.com/Microsoft/vsts-agent/releases/download/v2.123.0/vsts-agent-ubuntu.16.04-x64-2.123.0.tar.gz -O vsts-agent-ubuntu.16.04-x64-2.123.0.tar.gz
mkdir agent &amp;&amp; cd agent
tar -xvf ../vsts-agent-ubuntu.16.04-x64-2.123.0.tar.gz
./config.sh
<h1 id="r%C3%A9pondez-aux-questions">Répondez aux questions <a class="direct-link" href="#r%C3%A9pondez-aux-questions"> </a></h1>
<p>sudo ./svc.sh install<br>
sudo ./svc.sh start</p>
<pre><code>Pour plus d'info sur l'[agent VSTS](https://docs.microsoft.com/fr-fr/vsts/build-release/actions/agents/v2-linux)
&lt;h3&gt;Vérification dans VSTS&lt;/h3&gt;
Si vous accédez à l'url https://{votrenomavous}.visualstudio.com/_admin/_AgentPool vous devriez voir que votre agent est en vert !
&lt;img class=&quot;alignnone size-full wp-image-321&quot; src=&quot;https://etienne.deneuve.xyz/wp-content/uploads/2017/10/Capture-Agent-Pool.png&quot; alt=&quot;&quot; width=&quot;565&quot; height=&quot;145&quot; /&gt;
</code></pre>

      </main>
      <aside class="aside aside-supplemental d-none d-lg-block col-lg-2 col-xl-2" >
        <nav class="sticky-top">
        <div class="">
                <ol>
                    
                    <li><a href="#cr%C3%A9ation-du-projet">Création du Projet  </a>
            		</li>

                    <li><a href="#initialisation-du-repository">Initialisation du repository  </a>
            		</li>

                    <li><a href="#pr%C3%A9paration-de-la-vm">Préparation de la VM  </a>
            		</li>
                </ol>
            </div>
        </nav>
      </aside>
    </div>
  </div>
</div>

    <footer class="site-footer bg-transparent pb-3 pb-md-5">
      <div class="layout-social container d-flex justify-content-center">

  

  

  

  

  

  

  

</div>
    </footer>
  </body>

</html>